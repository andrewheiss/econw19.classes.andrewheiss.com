---
title: "Lab 1"
date: "2019-01-11"
output:
  blogdown::html_page:
    template: ../../pandoc/toc-title_html.template
    toc: true
---

<!-- BLOGDOWN-HEAD -->
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>
<!-- /BLOGDOWN-HEAD -->

<h2>Contents</h2>
<div id="TOC">
<ul>
<li><a href="#things-well-do">Things we’ll do</a></li>
<li><a href="#inflation-related-formulas">Inflation-related formulas</a><ul>
<li><a href="#nominal-to-real">Nominal to real</a></li>
<li><a href="#shifting-cpi">Shifting CPI</a></li>
<li><a href="#inflation-rate">Inflation rate</a></li>
<li><a href="#compounding-inflation">Compounding inflation</a></li>
</ul></li>
<li><a href="#inflation-fun-with-excel">Inflation fun with Excel</a></li>
<li><a href="#inflation-fun-with-r">Inflation fun with R</a><ul>
<li><a href="#live-code">Live code</a></li>
<li><a href="#cleaner-code">Cleaner code</a></li>
</ul></li>
</ul>
</div>

<h2 id="things-well-do">Things we’ll do</h2>
<ul>
<li>Convert nominal values to real values</li>
<li>Rescale the CPI to a different year</li>
<li>Calculate inflation rate</li>
<li>Calculate average inflation over time</li>
<li>Compounding inflation</li>
</ul>
<h2 id="inflation-related-formulas">Inflation-related formulas</h2>
<h3 id="nominal-to-real">Nominal to real</h3>
<p>Converting nominal values (the numbers written down at the time) to real values (the numbers in today’s / another year’s dollars):</p>
<p><span class="math display">\[
\text{Real value} = \frac{\text{Nominal value}}{\text{Price index / 100}}
\]</span></p>
<h3 id="shifting-cpi">Shifting CPI</h3>
<p>Shifting the price index to a different year:</p>
<p><span class="math display">\[
\text{Price index}_{\text{new year}} = \frac{\text{Price index}_{\text{current year}}}{\text{Price index}_{\text{new year}}} \times 100
\]</span></p>
<h3 id="inflation-rate">Inflation rate</h3>
<p>The inflation rate is the percent change in CPI between two periods. The formula for percent change is:</p>
<p><span class="math display">\[
\text{% change} = \frac{\text{New} - \text{Old}}{\text{Old}}
\]</span></p>
<p>or</p>
<p><span class="math display">\[
\text{% change} = \frac{\text{Current} - \text{Previous}}{\text{Previous}}
\]</span></p>
<p><em>Pay attention</em> to the time periods in data from FRED.<span><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="sidenote">Or anywhere, really.<br />
<br />
</span></span> Datasets like <a href="https://fred.stlouisfed.org/series/GDP">GDP</a> are reported quarterly, while the <a href="https://fred.stlouisfed.org/series/CPIAUCSL">CPI</a> is monthly. If you need to calculate the annual change (or annual inflation), make sure you either (1) use the same month or quarter as your current and previous times (i.e. January 2016 and January 2017), or (2) add all the percent changes within the year (i.e. add the rates from January 2016, April 2016, July 2017, and October 2017).</p>
<h3 id="compounding-inflation">Compounding inflation</h3>
<p>The compound average inflation rate is the percent that if the CPI had grown at that rate, compounded, from the start year to the end year, the same CPI would occur in the end year. To calculate this, use the formula for compounding interest, where <span class="math inline">\(A\)</span> is the CPI or price at the end of time period we’re concerned about, <span class="math inline">\(P\)</span> the CPI or price at the beginning of the time period we’re concerned about, <span class="math inline">\(n\)</span> is the number of times the rate is compounded each year, <span class="math inline">\(t\)</span> is the number of years, and <span class="math inline">\(r\)</span> is the rate that you want to solve for:</p>
<p><span class="math display">\[ 
A = P (1 + \frac{r}{n})^{nt} 
\]</span></p>
<p>If we assume interest is compounded once a year, <span class="math inline">\(n\)</span> is 1 and can disappear. This simplifies to:</p>
<p><span class="math display">\[
\text{CPI}_{\text{new}} = \text{CPI}_{\text{old}}(1 + r)^{t}
\]</span></p>
<p>We can rearrange the formula so that <span class="math inline">\(r\)</span> is on the righthand side by dividing, exponentiating, logging, and subtracting:</p>
<p><span class="math display">\[
r = exp(\frac{ln(\frac{\text{CPI}_{\text{new}}}{\text{CPI}_{\text{old}}})}{t}) - 1
\]</span></p>
<p>Alternatively, instead of assuming annually compounding interest, we can also assume exponential growth (or continually compounding interest), which uses the following formula (again where <span class="math inline">\(A\)</span>, <span class="math inline">\(P\)</span>, <span class="math inline">\(r\)</span>, and <span class="math inline">\(t\)</span> are the prices in the last year, prices in the first year, the rate, and the number of years:</p>
<p><span class="math display">\[
A = Pe^{rt}
\]</span></p>
<p>Or</p>
<p><span class="math display">\[
\text{CPI}_{\text{new}} = \text{CPI}_{\text{old}}e^{rt}
\]</span></p>
<p>We can again rearrange the formula so that <span class="math inline">\(r\)</span> is on the righthand side:</p>
<p><span class="math display">\[
r = \frac{ln(\frac{\text{CPI}_{\text{new}}}{\text{CPI}_{\text{old}}})}{t}
\]</span></p>
<h2 id="inflation-fun-with-excel">Inflation fun with Excel</h2>
<p>Download these files:</p>
<ul>
<li><a href="/data/fred_cpi.xlsx"><i class="fas fa-file-excel"></i> <code>fred_cpi.xlsx</code></a></li>
<li><a href="/data/fred_gdp.xlsx"><i class="fas fa-file-excel"></i> <code>fred_gdp.xlsx</code></a></li>
</ul>
<p>I’ll put the complete version of the Excel file here after the lab.</p>
<p>Here’s the complete worked-out, cleaned-up example:</p>
<ul>
<li><a href="/files/fred_cpi_playground.xlsx"><i class="fas fa-file-excel"></i> <code>fred_cpi_playground.xlsx</code></a></li>
</ul>
<h2 id="inflation-fun-with-r">Inflation fun with R</h2>
<h3 id="live-code">Live code</h3>
<p>Use this link to see the code that I’m actually typing:</p>
<ul>
<li><i class="fas fa-globe"></i> <a href="https://andhs.co/live-code" class="uri">https://andhs.co/live-code</a></li>
</ul>
<p>I’ve saved the R script to Dropbox, and that link goes to a live version of that file. Refresh or re-open the link as needed to copy/paste code I type up on the screen.</p>
<h3 id="cleaner-code">Cleaner code</h3>
<p>First, load the data (either from a file you downloaded and placed in an <a href="https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects">RStudio project</a>, or directly from the class website):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)  <span class="co"># Load ggplot, dplyr, tidyr, and friends</span>
<span class="kw">library</span>(lubridate)  <span class="co"># Do cool stuff with dates</span>
<span class="kw">library</span>(readxl)     <span class="co"># Read Excel files into R</span>

<span class="co"># From your computer (make sure the path to fred_cpi.xlsx is correct)</span>
fred_cpi_raw &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;fred_cpi.xlsx&quot;</span>)
fred_gdp_raw &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;fred_gdp.xlsx&quot;</span>)</code></pre>
<p>If you use the <code>mutate()</code> function from <code>dplyr</code>, it’s easy to create new columns based on inflation adjustment math. You can also exctract CPI values for specific years using a combination of <code>filter()</code> and <code>pull()</code> and then shift the CPI around to a different year.</p>
<p>Here’s some income per capita adjustment:</p>
<pre class="sourceCode r"><code class="sourceCode r">cpi_<span class="dv">2018</span> &lt;-<span class="st"> </span>fred_cpi_raw <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">year</span>(Date) <span class="op">==</span><span class="st"> </span><span class="dv">2018</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pull</span>(CPI)

fred_cpi &lt;-<span class="st"> </span>fred_cpi_raw <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Only look at a few columns</span>
<span class="st">  </span><span class="kw">select</span>(Date, CPI, <span class="st">`</span><span class="dt">Personal income</span><span class="st">`</span>, Population) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">income_per_capita =</span> <span class="st">`</span><span class="dt">Personal income</span><span class="st">`</span> <span class="op">/</span><span class="st"> </span>Population) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">real_income_per_capita =</span> income_per_capita <span class="op">/</span><span class="st"> </span>(CPI <span class="op">/</span><span class="st"> </span><span class="dv">100</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cpi_2018 =</span> CPI <span class="op">/</span><span class="st"> </span>cpi_<span class="dv">2018</span> <span class="op">*</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">real_income_2018 =</span> income_per_capita <span class="op">/</span><span class="st"> </span>(cpi_<span class="dv">2018</span> <span class="op">/</span><span class="st"> </span><span class="dv">100</span>))

<span class="co"># See what the first few values of each column are</span>
<span class="kw">glimpse</span>(fred_cpi)</code></pre>
<pre><code>## Observations: 40
## Variables: 8
## $ Date                   &lt;dttm&gt; 1979-01-01, 1980-01-01, 1981-01-01, 1982…
## $ CPI                    &lt;dbl&gt; 68.5, 78.0, 87.2, 94.4, 97.9, 102.1, 105.…
## $ `Personal income`      &lt;dbl&gt; 2.005384e+12, 2.231943e+12, 2.508890e+12,…
## $ Population             &lt;dbl&gt; 225055000, 227225000, 229466000, 23166400…
## $ income_per_capita      &lt;dbl&gt; 8910.640, 9822.612, 10933.602, 11774.976,…
## $ real_income_per_capita &lt;dbl&gt; 13008.23, 12593.09, 12538.53, 12473.49, 1…
## $ cpi_2018               &lt;dbl&gt; 27.48300, 31.29451, 34.98566, 37.87438, 3…
## $ real_income_2018       &lt;dbl&gt; 32422.37, 31387.65, 31251.67, 31089.55, 3…</code></pre>
<p>And here’s some GDP adjustment using the GDP deflator:</p>
<pre class="sourceCode r"><code class="sourceCode r">fred_gdp &lt;-<span class="st"> </span>fred_gdp_raw <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp_per_capita =</span> GDP <span class="op">/</span><span class="st"> </span>Population) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp_per_capita_2012 =</span> gdp_per_capita <span class="op">/</span><span class="st"> </span>(<span class="st">`</span><span class="dt">GDP deflator</span><span class="st">`</span> <span class="op">/</span><span class="st"> </span><span class="dv">100</span>))</code></pre>
<p>Finally, here’s a demonstration of why it’s important to adjust for inflation. We can plot GDP per capita as both nominal dollars (what was written down at the time) and real dollars (2012 dollars):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Make a dataset for plotting</span>
plot_fred_gdp &lt;-<span class="st"> </span>fred_gdp <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Only select the date and the GDP per capita variables + rename them</span>
<span class="st">  </span><span class="kw">select</span>(Date, <span class="dt">Nominal =</span> gdp_per_capita, <span class="dt">Real =</span> gdp_per_capita_<span class="dv">2012</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Make this a long/tidy data frame, with one column for the GDP values and one</span>
<span class="st">  </span><span class="co"># column for the type of value (real vs. nominal)</span>
<span class="st">  </span><span class="kw">gather</span>(gdp_type, value, <span class="op">-</span>Date)

<span class="co"># Plot this!</span>
<span class="kw">ggplot</span>(plot_fred_gdp, <span class="kw">aes</span>(<span class="dt">x =</span> Date, <span class="dt">y =</span> value, <span class="dt">color =</span> gdp_type)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre>
<p><img src="/class/01-lab_files/figure-html/plot-gdp-1.png" width="672" /></p>
